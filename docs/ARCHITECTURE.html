<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Toast App - Architecture</title>
    <link rel="icon" href="assets/icons/icon.png">
    <link rel="stylesheet" href="styles.css">
    <meta name="description" content="Toast App architecture documentation - System design, component structure, and technical decisions.">
    <style>
        .documentation-container {
            max-width: 900px;
            margin: 7rem auto 0;
            padding: 2rem;
        }

        .architecture-section {
            margin-bottom: 4rem;
            padding-top: 1rem;
        }

        .architecture-section h2 {
            padding-bottom: 0.8rem;
            border-bottom: 1px solid var(--border-color);
            margin-top: 2rem;
            font-size: 1.8rem;
            color: var(--primary-color);
        }

        .architecture-section h3 {
            margin-top: 1.8rem;
            margin-bottom: 1rem;
            font-size: 1.4rem;
            color: var(--text-color);
        }

        .architecture-section p {
            margin-bottom: 1.2rem;
            color: var(--text-light);
        }

        .architecture-section ul,
        .architecture-section ol {
            margin-left: 1.5rem;
            margin-bottom: 1.5rem;
            color: var(--text-light);
        }

        .architecture-section li {
            margin-bottom: 0.8rem;
        }

        .architecture-section code {
            background-color: var(--code-bg);
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-size: 0.9rem;
            border: 1px solid var(--code-border);
        }

        .architecture-section pre {
            background-color: var(--code-bg);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            overflow-x: auto;
            margin-bottom: 2rem;
            border: 1px solid var(--code-border);
            position: relative;
        }

        .architecture-section pre::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            width: 4px;
            background: linear-gradient(to bottom, var(--primary-color), var(--secondary-color));
            border-radius: var(--border-radius) 0 0 var(--border-radius);
        }

        .architecture-diagram {
            width: 100%;
            max-width: 700px;
            margin: 2rem auto;
            display: block;
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
        }

        .return-home {
            display: inline-block;
            margin-bottom: 2rem;
        }

        .table-of-contents {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 2rem;
            margin-bottom: 3rem;
            box-shadow: var(--card-shadow);
            border: 1px solid var(--border-color);
            transition: all var(--transition-speed) ease;
        }

        .table-of-contents:hover {
            box-shadow: var(--card-hover-shadow);
        }

        .table-of-contents h2 {
            margin-top: 0;
            position: relative;
            padding-bottom: 10px;
        }

        .table-of-contents h2::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            height: 3px;
            width: 50px;
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            border-radius: 2px;
        }

        .table-of-contents ol {
            margin-bottom: 0;
            padding-left: 1.5rem;
        }

        .table-of-contents li {
            margin-bottom: 0.7rem;
        }

        .table-of-contents a {
            color: var(--primary-color);
            text-decoration: none;
            transition: all 0.2s ease;
            font-weight: 500;
        }

        .table-of-contents a:hover {
            color: var(--secondary-color);
            text-decoration: underline;
        }

        html {
            scroll-padding-top: 80px; /* Offset for fixed header */
        }
    </style>
</head>
<body>
    <nav id="main-nav">
        <div class="nav-container container">
            <a href="index.html" class="nav-logo">
                <img src="assets/icons/icon.png" alt="Toast App Logo">
                <span>Toast App</span>
            </a>
            <button class="mobile-menu-btn" aria-label="Open Menu">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="3" y1="12" x2="21" y2="12"></line>
                    <line x1="3" y1="6" x2="21" y2="6"></line>
                    <line x1="3" y1="18" x2="21" y2="18"></line>
                </svg>
            </button>
            <ul class="nav-links">
                <li><a href="index.html#features">Features</a></li>
                <li><a href="index.html#installation">Installation</a></li>
                <li><a href="index.html#usage">Usage</a></li>
                <li><a href="index.html#documentation">Documentation</a></li>
                <li><a href="index.html#download">Download</a></li>
                <li><a href="https://github.com/opspresso/toast-app" target="_blank">GitHub</a></li>
            </ul>
        </div>
    </nav>

    <div class="documentation-container">
        <a href="index.html" class="return-home btn btn-outline">‚Üê Back to Home</a>

        <h1 class="fadeIn">Toast App Architecture</h1>

        <p class="fadeIn delay-1">This document outlines the system architecture and design decisions behind Toast App, a customizable shortcut launcher for macOS and Windows.</p>

        <div class="table-of-contents">
            <h2>Table of Contents</h2>
            <ol>
                <li><a href="#architecture-overview">Architecture Overview</a></li>
                <li><a href="#system-components">System Components</a></li>
                <li><a href="#data-flow">Data Flow</a></li>
                <li><a href="#technical-stack">Technical Stack</a></li>
                <li><a href="#ui-architecture">UI Architecture</a></li>
                <li><a href="#process-management">Process Management</a></li>
                <li><a href="#platform-specifics">Platform-Specific Implementations</a></li>
                <li><a href="#security-considerations">Security Considerations</a></li>
                <li><a href="#performance-optimizations">Performance Optimizations</a></li>
                <li><a href="#future-architecture">Future Architecture Directions</a></li>
            </ol>
        </div>

        <div class="architecture-section" id="architecture-overview">
            <h2>Architecture Overview</h2>
            <p>Toast App is built on Electron, allowing it to run as a cross-platform desktop application. The architecture follows a modular design with clear separation of concerns between the main process (backend) and renderer processes (UI).</p>

            <p>Key architectural principles:</p>
            <ul>
                <li><strong>Modularity:</strong> Components are designed with single responsibilities and clear interfaces.</li>
                <li><strong>Process Isolation:</strong> Core functionality runs in the main process, separate from UI rendering.</li>
                <li><strong>Configuration-Driven:</strong> Most behavior is driven by a centralized JSON configuration file.</li>
                <li><strong>Event-Based Communication:</strong> Components communicate through a well-defined event system.</li>
                <li><strong>Platform Abstraction:</strong> Platform-specific code is isolated behind common interfaces.</li>
            </ul>
        </div>

        <div class="architecture-section" id="system-components">
            <h2>System Components</h2>

            <h3>Main Process Components</h3>
            <ul>
                <li><strong>Config Manager:</strong> Handles loading, saving, and validating user configuration.</li>
                <li><strong>Shortcut Manager:</strong> Registers and manages global keyboard shortcuts.</li>
                <li><strong>Window Manager:</strong> Controls application windows, including the popup and settings windows.</li>
                <li><strong>Tray Manager:</strong> Manages the system tray/menu bar icon and context menu.</li>
                <li><strong>Executor:</strong> Executes actions triggered by buttons (commands, URLs, shortcuts, scripts).</li>
                <li><strong>IPC Handler:</strong> Manages communication between main and renderer processes.</li>
                <li><strong>Auto-Launcher:</strong> Handles automatic startup on login.</li>
            </ul>

            <h3>Renderer Process Components</h3>
            <ul>
                <li><strong>Toast UI:</strong> The main popup interface showing buttons and handling user interactions.</li>
                <li><strong>Settings UI:</strong> The configuration interface for managing buttons and application settings.</li>
                <li><strong>Page Manager:</strong> Handles navigation between button pages in the Toast UI.</li>
                <li><strong>Button Renderer:</strong> Renders individual buttons with appropriate styles and shortcuts.</li>
                <li><strong>Search Engine:</strong> Filters buttons based on user input in the search bar.</li>
                <li><strong>Theme Engine:</strong> Applies visual themes to the UI based on user preferences.</li>
            </ul>
        </div>

        <div class="architecture-section" id="data-flow">
            <h2>Data Flow</h2>

            <h3>Startup Flow</h3>
            <ol>
                <li>Main process starts and initializes core components.</li>
                <li>Config Manager loads user configuration or creates default configuration if none exists.</li>
                <li>Tray Manager creates the system tray icon.</li>
                <li>Shortcut Manager registers the global hotkey.</li>
                <li>Auto-Launcher configures startup behavior based on settings.</li>
            </ol>

            <h3>Toast Popup Flow</h3>
            <ol>
                <li>User presses global hotkey.</li>
                <li>Shortcut Manager receives the hotkey event and notifies Window Manager.</li>
                <li>Window Manager creates or shows the Toast popup window.</li>
                <li>Toast UI loads and displays the current page of buttons.</li>
                <li>User interacts with buttons or navigates between pages.</li>
                <li>When a button is clicked, Toast UI sends an action request to the main process.</li>
                <li>Executor processes the action and performs the requested operation.</li>
                <li>Window Manager hides the Toast popup window after the action is complete (if configured).</li>
            </ol>

            <h3>Settings Flow</h3>
            <ol>
                <li>User opens settings from the tray menu.</li>
                <li>Window Manager creates or shows the Settings window.</li>
                <li>Settings UI loads the current configuration.</li>
                <li>User modifies configuration through the Settings UI.</li>
                <li>When changes are saved, Settings UI sends the updated configuration to the main process.</li>
                <li>Config Manager validates and saves the new configuration.</li>
                <li>Main process components reload with the new configuration.</li>
            </ol>
        </div>

        <div class="architecture-section" id="technical-stack">
            <h2>Technical Stack</h2>

            <h3>Core Technologies</h3>
            <ul>
                <li><strong>Electron:</strong> Cross-platform desktop application framework.</li>
                <li><strong>Node.js:</strong> JavaScript runtime for the main process.</li>
                <li><strong>HTML/CSS/JavaScript:</strong> Frontend technologies for the renderer processes.</li>
            </ul>

            <h3>Key Libraries</h3>
            <ul>
                <li><strong>electron-store:</strong> Persistent storage for configuration.</li>
                <li><strong>electron-localshortcut:</strong> Global keyboard shortcut registration.</li>
                <li><strong>robotjs:</strong> System-level automation for keyboard shortcuts and some commands.</li>
                <li><strong>node-fetch:</strong> Network requests for certain command types.</li>
                <li><strong>electron-is-dev:</strong> Development mode detection.</li>
                <li><strong>electron-log:</strong> Logging solution.</li>
            </ul>

            <h3>Build System</h3>
            <ul>
                <li><strong>electron-builder:</strong> Packaging and distribution.</li>
                <li><strong>webpack:</strong> Code bundling and optimization.</li>
                <li><strong>babel:</strong> JavaScript transpilation for compatibility.</li>
                <li><strong>eslint:</strong> Code quality and style enforcement.</li>
                <li><strong>jest:</strong> Testing framework.</li>
            </ul>
        </div>

        <div class="architecture-section" id="ui-architecture">
            <h2>UI Architecture</h2>

            <h3>Component Structure</h3>
            <p>The UI follows a component-based architecture with reusable elements. Each component has:</p>
            <ul>
                <li>HTML structure defining the component layout.</li>
                <li>CSS styles for visual appearance.</li>
                <li>JavaScript for behavior and interactivity.</li>
            </ul>

            <h3>UI Components</h3>
            <ul>
                <li><strong>ButtonGrid:</strong> Displays buttons in a grid layout.</li>
                <li><strong>Button:</strong> Individual action button with icon, name, and shortcut.</li>
                <li><strong>PageTabs:</strong> Navigation interface for switching between pages.</li>
                <li><strong>SearchBar:</strong> Input field for searching buttons.</li>
                <li><strong>SettingsPanel:</strong> Configuration interface for application settings.</li>
                <li><strong>ButtonEditor:</strong> Form for creating and editing buttons.</li>
            </ul>

            <h3>Theme System</h3>
            <p>The theme system uses CSS variables to define color schemes. Three themes are available:</p>
            <ul>
                <li><strong>Light:</strong> Light background with dark text.</li>
                <li><strong>Dark:</strong> Dark background with light text.</li>
                <li><strong>System:</strong> Automatically follows the operating system's theme.</li>
            </ul>
        </div>

        <div class="architecture-section" id="process-management">
            <h2>Process Management</h2>

            <h3>Process Types</h3>
            <ul>
                <li><strong>Main Process:</strong> Singleton process that coordinates all application functionality.</li>
                <li><strong>Renderer Processes:</strong> Each window has its own renderer process for UI.</li>
            </ul>

            <h3>Inter-Process Communication (IPC)</h3>
            <p>Communication between processes follows a request-response pattern using Electron's IPC mechanisms:</p>
            <ul>
                <li><strong>Synchronous Messages:</strong> Used for immediate responses (e.g., getting configuration).</li>
                <li><strong>Asynchronous Messages:</strong> Used for operations that take time (e.g., executing actions).</li>
                <li><strong>Broadcast Events:</strong> Used to notify all windows of system changes (e.g., theme changes).</li>
            </ul>

            <h3>Process Lifecycle</h3>
            <ul>
                <li><strong>Startup:</strong> Main process starts first, then creates renderer processes as needed.</li>
                <li><strong>Background Operation:</strong> Main process continues running even when all windows are closed.</li>
                <li><strong>Shutdown:</strong> Triggered by explicit quit from tray menu or system shutdown.</li>
            </ul>
        </div>

        <div class="architecture-section" id="platform-specifics">
            <h2>Platform-Specific Implementations</h2>

            <h3>macOS Specifics</h3>
            <ul>
                <li><strong>Menu Bar Integration:</strong> Uses macOS menu bar instead of system tray.</li>
                <li><strong>AppleScript Support:</strong> Allows execution of AppleScript in custom script buttons.</li>
                <li><strong>Native Notifications:</strong> Uses macOS notification center.</li>
                <li><strong>Touch Bar Support:</strong> Optional integration with Touch Bar on supported MacBooks.</li>
            </ul>

            <h3>Windows Specifics</h3>
            <ul>
                <li><strong>System Tray:</strong> Uses Windows system tray for the application icon.</li>
                <li><strong>PowerShell Support:</strong> Allows execution of PowerShell scripts in custom script buttons.</li>
                <li><strong>Windows Notifications:</strong> Uses Windows notification system.</li>
                <li><strong>Registry Integration:</strong> For automatic startup configuration.</li>
            </ul>

            <h3>Platform Abstraction</h3>
            <p>To manage platform differences, Toast App uses a platform abstraction layer that:</p>
            <ul>
                <li>Detects the current operating system.</li>
                <li>Selects appropriate implementations for platform-specific features.</li>
                <li>Provides fallbacks for unavailable features.</li>
            </ul>
        </div>

        <div class="architecture-section" id="security-considerations">
            <h2>Security Considerations</h2>

            <h3>Command Execution</h3>
            <p>Since Toast App can execute system commands, several security measures are implemented:</p>
            <ul>
                <li><strong>Limited Shell Access:</strong> Only predefined command types are allowed.</li>
                <li><strong>Sandboxing:</strong> Renderer processes run in a sandboxed environment with limited privileges.</li>
                <li><strong>Input Validation:</strong> All user inputs are validated before execution.</li>
                <li><strong>No Remote Code:</strong> All functionality is local, with no remote code execution.</li>
            </ul>

            <h3>Data Security</h3>
            <ul>
                <li><strong>Local Storage Only:</strong> All configuration data is stored locally, not sent to any servers.</li>
                <li><strong>Encrypted Storage:</strong> Configuration file uses basic encryption to prevent casual tampering.</li>
                <li><strong>Permission Model:</strong> Follows least-privilege principles for system access.</li>
            </ul>
        </div>

        <div class="architecture-section" id="performance-optimizations">
            <h2>Performance Optimizations</h2>

            <h3>Startup Performance</h3>
            <ul>
                <li><strong>Lazy Loading:</strong> Components are loaded only when needed.</li>
                <li><strong>Minimal UI:</strong> Initial launch displays only the tray icon, not full UI.</li>
                <li><strong>Cached Configuration:</strong> Configuration is cached to avoid repeated disk reads.</li>
            </ul>

            <h3>Runtime Performance</h3>
            <ul>
                <li><strong>Window Recycling:</strong> Windows are hidden rather than destroyed when closed.</li>
                <li><strong>Debounced Events:</strong> Frequent events (like window resizing) are debounced.</li>
                <li><strong>Virtual List:</strong> For large button collections, virtual scrolling is used.</li>
                <li><strong>Async Operations:</strong> Time-consuming operations run asynchronously to avoid UI blocking.</li>
            </ul>

            <h3>Memory Usage</h3>
            <ul>
                <li><strong>Process Management:</strong> Renderer processes are limited to essential windows.</li>
                <li><strong>Resource Cleanup:</strong> Unused resources are promptly released.</li>
                <li><strong>Optimized Dependencies:</strong> Dependencies are carefully chosen to minimize bloat.</li>
            </ul>
        </div>

        <div class="architecture-section" id="future-architecture">
            <h2>Future Architecture Directions</h2>

            <h3>Planned Enhancements</h3>
            <ul>
                <li><strong>Plugin System:</strong> Allow third-party extensions via a plugin API.</li>
                <li><strong>Cloud Sync:</strong> Optional synchronization of configuration across devices.</li>
                <li><strong>Advanced Theming:</strong> Custom theme editor and more visual customization options.</li>
                <li><strong>Workflow Automation:</strong> Support for multi-step action sequences.</li>
            </ul>

            <h3>Technical Debt and Refactoring</h3>
            <ul>
                <li><strong>Modularization:</strong> Further separation of concerns in the codebase.</li>
                <li><strong>Testing Coverage:</strong> Expanding automated tests for all components.</li>
                <li><strong>TypeScript Migration:</strong> Gradual conversion to TypeScript for better type safety.</li>
                <li><strong>Performance Profiling:</strong> Systematic performance analysis and optimization.</li>
            </ul>
        </div>
    </div>

    <footer>
        <div class="container">
            <p>&copy; 2025 Toast App. MIT License.</p>
            <ul class="footer-links">
                <li><a href="https://github.com/opspresso/toast-app" target="_blank">GitHub</a></li>
                <li><a href="CONTRIBUTING.html">Contributing</a></li>
                <li><a href="CODE_OF_CONDUCT.html">Code of Conduct</a></li>
                <li><a href="SECURITY.html">Security</a></li>
            </ul>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Mobile menu toggle
            const mobileMenuBtn = document.querySelector('.mobile-menu-btn');
            const navLinks = document.querySelector('.nav-links');

            mobileMenuBtn.addEventListener('click', function() {
                navLinks.classList.toggle('active');
            });

            // Navigation scroll effect
            const nav = document.getElementById('main-nav');

            window.addEventListener('scroll', function() {
                if (window.scrollY > 50) {
                    nav.classList.add('nav-scrolled');
                } else {
                    nav.classList.remove('nav-scrolled');
                }
            });

            // Smooth scrolling
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();

                    const targetId = this.getAttribute('href');
                    if (targetId === '#') return;

                    const targetElement = document.querySelector(targetId);
                    if (targetElement) {
                        targetElement.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });

                        // Close mobile menu if it's open
                        if (navLinks.classList.contains('active')) {
                            navLinks.classList.remove('active');
                        }
                    }
                });
            });

            // Simple animation for the content
            document.querySelectorAll('.architecture-section').forEach((element, index) => {
                element.classList.add('fadeIn');
                element.style.animationDelay = `${index * 0.1}s`;
            });
        });
    </script>
</body>
</html>
