<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Toast Settings</title>
    <link rel="stylesheet" href="styles.css" />
  </head>

  <body>
    <div class="settings-container">
      <header class="settings-header">
        <h1>Toast Settings</h1>
        <div class="header-actions">
          <button id="cancel-button" class="secondary-button">Close</button>
        </div>
      </header>

      <div class="settings-content">
        <div class="settings-sidebar">
          <ul class="settings-nav">
            <li data-tab="general" class="active">General</li>
            <li data-tab="appearance">Appearance</li>
            <li data-tab="account">Account & Subscription</li>
            <li data-tab="cloud-sync">Cloud Sync</li>
            <li data-tab="advanced">Advanced</li>
            <li data-tab="about">About</li>
          </ul>
        </div>

        <div class="settings-main">
          <!-- General Settings Tab -->
          <div id="general" class="settings-tab active">
            <h2>General Settings</h2>

            <div class="settings-group">
              <label for="global-hotkey">Global Hotkey</label>
              <div class="hotkey-input-container">
                <input
                  type="text"
                  id="global-hotkey"
                  placeholder="Click to record hotkey"
                  readonly
                />
                <button id="record-hotkey" class="small-button">Record</button>
                <button id="clear-hotkey" class="small-button">Clear</button>
              </div>
              <p class="help-text">Press the key combination you want to use to open Toast.</p>
            </div>

            <div class="settings-group">
              <label>
                <input type="checkbox" id="launch-at-login" />
                Launch at login
              </label>
              <p class="help-text">
                Start Toast automatically when you log in to your computer.
              </p>
            </div>
          </div>

          <!-- Appearance Tab -->
          <div id="appearance" class="settings-tab">
            <h2>Appearance</h2>

            <div class="settings-group">
              <label for="theme">Theme</label>
              <select id="theme">
                <option value="system">System Default</option>
                <option value="light">Light</option>
                <option value="dark">Dark</option>
              </select>
              <p class="help-text">Choose the application theme.</p>
            </div>

            <div class="settings-group">
              <label for="position">Window Position</label>
              <select id="position">
                <option value="center">Center</option>
                <option value="top">Top</option>
                <option value="bottom">Bottom</option>
                <option value="cursor">Cursor</option>
              </select>
              <p class="help-text">Where the Toast window should appear on the screen.</p>
            </div>

            <div class="settings-group">
              <label for="size">Window Size</label>
              <select id="size">
                <option value="small">Small</option>
                <option value="medium">Medium</option>
                <option value="large">Large</option>
              </select>
              <p class="help-text">Size of the Toast window.</p>
            </div>

            <div class="settings-group">
              <label for="opacity">Window Opacity</label>
              <div class="range-container">
                <input type="range" id="opacity" min="0.1" max="1.0" step="0.05" value="0.95" />
                <span id="opacity-value">0.95</span>
              </div>
              <p class="help-text">Transparency of the Toast window.</p>
            </div>
          </div>

          <!-- Account & Subscription Tab -->
          <div id="account" class="settings-tab">
            <h2>Account & Subscription</h2>

            <!-- Login state (before sign-in) -->
            <div id="login-section" class="settings-group">
              <div class="auth-container">
                <p>Sign in to access premium features and sync your settings across devices.</p>
                <button id="login-button" class="primary-button">Sign In</button>
                <div id="auth-loading" class="loading-indicator hidden">
                  <div class="spinner"></div>
                  <p>Processing...</p>
                </div>
              </div>
            </div>

            <!-- Login state (after sign-in) -->
            <div id="profile-section" class="settings-group hidden">
              <div class="profile-container">
                <div class="profile-header">
                  <div id="user-avatar" class="profile-avatar"></div>
                  <div class="profile-info">
                    <div id="user-name" class="profile-name">-</div>
                    <div id="user-email" class="profile-email">-</div>
                  </div>
                </div>
                <button id="logout-button" class="secondary-button">Sign Out</button>
              </div>
            </div>

            <!-- Subscription information -->
            <div id="subscription-section" class="settings-group hidden">
              <h3>Subscription</h3>
              <div class="subscription-container">
                <div class="subscription-details">
                  <div class="subscription-status">
                    <span id="subscription-badge" class="badge">Free</span>
                    <span id="subscription-status">-</span>
                  </div>
                  <p id="subscription-expiry">-</p>
                  <p id="subscription-features">-</p>
                </div>
                <div class="subscription-actions">
                  <button id="manage-subscription" class="primary-button">
                    Manage Subscription
                  </button>
                  <button id="refresh-subscription" class="secondary-button">Refresh Status</button>
                </div>
                <div id="subscription-loading" class="loading-indicator hidden">
                  <div class="spinner"></div>
                  <p>Loading subscription information...</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Advanced Tab -->
          <div id="advanced" class="settings-tab">
            <h2>Advanced Settings</h2>

            <div class="settings-group">
              <label>
                <input type="checkbox" id="hide-after-action" />
                Hide after action
              </label>
              <p class="help-text">Hide the Toast window after executing an action.</p>
            </div>

            <div class="settings-group">
              <label>
                <input type="checkbox" id="hide-on-blur" />
                Hide on blur
              </label>
              <p class="help-text">Hide the Toast window when it loses focus.</p>
            </div>

            <div class="settings-group">
              <label>
                <input type="checkbox" id="hide-on-escape" />
                Hide on Escape key
              </label>
              <p class="help-text">Hide the Toast window when the Escape key is pressed.</p>
            </div>

            <div class="settings-group">
              <label>
                <input type="checkbox" id="show-in-taskbar" />
                Show in taskbar
              </label>
              <p class="help-text">Show the Toast window in the taskbar/dock.</p>
            </div>

            <div class="settings-group actions-group">
              <button id="reset-settings" class="danger-button">Reset to Defaults</button>
              <p class="help-text">Reset all settings to their default values.</p>
            </div>
          </div>

          <!-- Cloud Sync Tab -->
          <div id="cloud-sync" class="settings-tab">
            <h2>Cloud Sync</h2>

            <!-- Sync Status -->
            <div id="sync-status-section" class="settings-group">
              <div class="subscription-container">
                <div class="subscription-details">
                  <div class="subscription-status">
                    <span id="sync-status-badge" class="badge">Disabled</span>
                    <span id="sync-status-text">Cloud Sync Status</span>
                  </div>
                  <p id="last-synced-time">Last Synced: -</p>
                  <p id="sync-device-info">Current Device: -</p>
                </div>
              </div>
            </div>

            <!-- Sync Controls -->
            <div class="settings-group">
              <h3>Sync Settings</h3>
              <div class="settings-group">
                <label>
                  <input type="checkbox" id="enable-cloud-sync" />
                  Enable Cloud Sync
                </label>
                <p class="help-text">
                  Synchronize settings and pages across multiple devices. Premium subscription
                  required.
                </p>
              </div>

              <div class="settings-group">
                <div class="subscription-actions">
                  <button id="manual-sync-upload" class="primary-button">Upload to Server</button>
                  <button id="manual-sync-download" class="primary-button">
                    Download from Server
                  </button>
                  <button id="manual-sync-resolve" class="secondary-button">
                    Resolve Conflicts
                  </button>
                </div>
                <div id="sync-loading" class="loading-indicator hidden">
                  <div class="spinner"></div>
                  <p>Syncing...</p>
                </div>
              </div>
            </div>
          </div>

          <!-- About Tab -->
          <div id="about" class="settings-tab">
            <h2>About Toast</h2>

            <div class="settings-group about-section">
              <div class="app-logo">
                <img src="../../assets/icon.png" alt="Toast Logo" width="100" />
              </div>

              <div class="app-info">
                <p class="app-version">
                  <strong>Version:</strong> <span id="app-version">v0.0.0</span>
                </p>
                <p class="app-description">
                  A customizable shortcut launcher for macOS and Windows
                </p>
                <p class="app-authors"><strong>Authors:</strong> nalbam &lt;me@nalbam.com&gt;</p>
                <p class="app-license"><strong>License:</strong> MIT</p>
              </div>

              <div class="app-links">
                <button id="homepage-link" class="secondary-button">Homepage</button>
                <button id="check-updates" class="primary-button">Check for Updates</button>
              </div>

              <div id="update-status" class="update-status hidden">
                <p id="update-message"></p>
                <div class="update-actions hidden" id="update-actions">
                  <button id="download-update" class="primary-button">Download Update</button>
                  <button id="install-update" class="primary-button">Install Update</button>
                </div>
                <div id="alternative-updates" class="alternative-updates hidden">
                  <p class="alternative-updates-title">Or you can update using these alternative methods:</p>
                  <div class="alternative-method">
                    <code>brew upgrade opspresso/tap/toast</code>
                    <button id="copy-brew-command" class="small-button" title="Copy to clipboard">Copy</button>
                  </div>
                  <div class="alternative-method github-method">
                    <a id="github-release-link" href="https://github.com/opspresso/toast-dist/releases/latest" target="_blank" class="github-button">
                      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg>
                      Download from GitHub Releases
                    </a>
                  </div>
                </div>
                <div id="update-loading" class="loading-indicator hidden">
                  <div class="spinner"></div>
                  <p>Checking for updates...</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="cloud-sync.js"></script>
    <script src="index.js"></script>
    <!-- 탭 활성화 문제 해결을 위한 즉시 실행 스크립트 -->
    <script>
      // 모든 컨텐츠가 로드된 후 실행
      document.addEventListener('DOMContentLoaded', function() {
        // 탭 관련 요소 선택
        const tabLinks = document.querySelectorAll('.settings-nav li');
        const tabContents = document.querySelectorAll('.settings-tab');

        // 각 탭 링크에 클릭 리스너 직접 추가
        tabLinks.forEach(link => {
          link.addEventListener('click', function(e) {
            e.preventDefault();
            const tabId = this.getAttribute('data-tab');

            // 모든 탭에서 active 클래스 제거
            tabLinks.forEach(item => {
              item.removeAttribute('class');
              item.style.backgroundColor = ''; // 스타일 리셋
              item.style.fontWeight = '';     // 스타일 리셋
            });

            // 클릭한 탭에 active 클래스 추가
            this.setAttribute('class', 'active');
            this.style.backgroundColor = getComputedStyle(document.documentElement).getPropertyValue('--sidebar-active-bg');
            this.style.fontWeight = '600';

            // 모든 컨텐츠 숨기기
            tabContents.forEach(content => {
              content.classList.remove('active');
            });

            // 선택한 탭 컨텐츠 표시
            const activeContent = document.getElementById(tabId);
            if (activeContent) {
              activeContent.classList.add('active');
            }

            // 로깅
            console.log(`탭 전환: ${tabId} / 활성화 여부: ${this.classList.contains('active')}`);
          });
        });
      });
    </script>
  </body>
</html>
